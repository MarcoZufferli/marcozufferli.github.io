<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content=" Table of Contents: What&rsquo;s Kerberos Delegation Unconstrained Delegation Constrained Delegation Constrained Delegation (Kerberos only) Constrained Delegation (Use any authentication Protocol) / Protocol Transition Resource Based Constrained Delegation (RBCD) Kerberos Delegation What&rsquo;s Kerberos Delegation? Before you begin, if you are not confident with Kerberos, i highly suggest you to start reading my other article called &ldquo;Not So Brief Overview about Kerberos&rdquo;.
Let&rsquo;s assume a scenario where a domain user authenticates via Kerberos to a &ldquo;Front-End&rdquo; AP (service) such as a Web Application, which, to operate correctly, must interact with a &ldquo;Back-End&rdquo; AP (service) such as a Database or a File Server.
"><meta name=keywords content="homepage,blog"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://marcozufferli.github.io/posts/demystify_kerberos_delegation/><title>Demystify Kerberos Delegation :: Marco Zufferli</title><link rel=stylesheet href=/main.min.0dd954f5c1cdd18e08d4ddf109cc7df2287009df00e21afb37a07ffae3f2eac5.css integrity="sha256-DdlU9cHN0Y4I1N3xCcx98ihwCd8A4hr7N6B/+uPy6sU=" crossorigin=anonymous><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Demystify Kerberos Delegation"><meta itemprop=description content="Table of Contents: What’s Kerberos Delegation Unconstrained Delegation Constrained Delegation Constrained Delegation (Kerberos only) Constrained Delegation (Use any authentication Protocol) / Protocol Transition Resource Based Constrained Delegation (RBCD) Kerberos Delegation What’s Kerberos Delegation? Before you begin, if you are not confident with Kerberos, i highly suggest you to start reading my other article called “Not So Brief Overview about Kerberos”.
Let’s assume a scenario where a domain user authenticates via Kerberos to a “Front-End” AP (service) such as a Web Application, which, to operate correctly, must interact with a “Back-End” AP (service) such as a Database or a File Server."><meta itemprop=datePublished content="2025-09-16T14:50:00+02:00"><meta itemprop=dateModified content="2025-09-16T14:50:00+02:00"><meta itemprop=wordCount content="6126"><meta itemprop=image content="https://marcozufferli.github.io/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://marcozufferli.github.io/"><meta name=twitter:title content="Demystify Kerberos Delegation"><meta name=twitter:description content="Table of Contents: What’s Kerberos Delegation Unconstrained Delegation Constrained Delegation Constrained Delegation (Kerberos only) Constrained Delegation (Use any authentication Protocol) / Protocol Transition Resource Based Constrained Delegation (RBCD) Kerberos Delegation What’s Kerberos Delegation? Before you begin, if you are not confident with Kerberos, i highly suggest you to start reading my other article called “Not So Brief Overview about Kerberos”.
Let’s assume a scenario where a domain user authenticates via Kerberos to a “Front-End” AP (service) such as a Web Application, which, to operate correctly, must interact with a “Back-End” AP (service) such as a Database or a File Server."><meta property="og:url" content="https://marcozufferli.github.io/posts/demystify_kerberos_delegation/"><meta property="og:site_name" content="Marco Zufferli"><meta property="og:title" content="Demystify Kerberos Delegation"><meta property="og:description" content="Table of Contents: What’s Kerberos Delegation Unconstrained Delegation Constrained Delegation Constrained Delegation (Kerberos only) Constrained Delegation (Use any authentication Protocol) / Protocol Transition Resource Based Constrained Delegation (RBCD) Kerberos Delegation What’s Kerberos Delegation? Before you begin, if you are not confident with Kerberos, i highly suggest you to start reading my other article called “Not So Brief Overview about Kerberos”.
Let’s assume a scenario where a domain user authenticates via Kerberos to a “Front-End” AP (service) such as a Web Application, which, to operate correctly, must interact with a “Back-End” AP (service) such as a Database or a File Server."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-09-16T14:50:00+02:00"><meta property="article:modified_time" content="2025-09-16T14:50:00+02:00"><meta property="og:image" content="https://marcozufferli.github.io/"><meta property="article:published_time" content="2025-09-16 14:50:00 +0200 CEST"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>su - lympier</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/posts>Blog</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span><span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
29 minutes</p></div><article><h1 class=post-title><a href=https://marcozufferli.github.io/posts/demystify_kerberos_delegation/>Demystify Kerberos Delegation</a></h1><div class=post-content><hr><h4 id=table-of-contents>Table of Contents:</h4><ul><li><strong><a href=/posts/demystify_kerberos_delegation/#whats-kerberos-delegation>What&rsquo;s Kerberos Delegation</a></strong></li><li><strong><a href=/posts/demystify_kerberos_delegation/#unconstrained-delegation>Unconstrained Delegation</a></strong></li><li><strong><a href=/posts/demystify_kerberos_delegation/#constrained-delegation>Constrained Delegation</a></strong><ul><li><strong><a href=/posts/demystify_kerberos_delegation/#constrained-delegation-kerberos-only>Constrained Delegation (Kerberos only)</a></strong></li><li><strong><a href=/posts/demystify_kerberos_delegation/#constrained-delegation-use-any-authentication-protocol--protocol-transition>Constrained Delegation (Use any authentication Protocol) / Protocol Transition</a></strong></li></ul></li><li><strong><a href=/posts/demystify_kerberos_delegation/#resource-based-constrained-delegation-rbcd>Resource Based Constrained Delegation (RBCD)</a></strong></li></ul><hr><h1 id=kerberos-delegation><strong>Kerberos Delegation</strong></h1><img src=/demystify_kerberos_delegation/immagine.jpg class=center style=border-radius:8px><h2 id=what><strong>What&rsquo;s Kerberos Delegation?</strong></h2><p>Before you begin, if you are not confident with Kerberos, i highly suggest you to start reading my other article called &ldquo;<a href=/posts/not_so_brief_overview_about_kerberos/>Not So Brief Overview about Kerberos</a>&rdquo;.</p><p>Let&rsquo;s assume a scenario where a domain user authenticates via Kerberos to a &ldquo;Front-End&rdquo; AP (service) such as a Web Application, which, to operate correctly, must interact with a &ldquo;Back-End&rdquo; AP (service) such as a Database or a File Server.</p><p>In this scenario, when the domain user authenticated via Kerberos performs a particular action on the Web Application, the Web Application will need to authenticate to the Database to retrieve some personal user data, instead of creating (if possible) an application user with extremely specific permissions for the Web Application to use for the Back-End service (in this case the Database), the issue would be resolved if the Web Application itself were able to authenticate via Kerberos to the &ldquo;Back-End&rdquo; service on behalf of the user; in this way, access could be granted exclusively and automatically to a specific portion of data; the Kerberos protocol allows this behavior and this is called Kerberos Delegation.</p><p>We know that the domain user &ldquo;ASTRO\Cosmo&rdquo; will present a TGS Ticket (<a href=/posts/not_so_brief_overview_about_kerberos/#37>KRB_AP_REP</a>) to authenticate to the Web Server, consequently, in a traditional Kerberos scenario, the Web Server CANNOT obtain a TGS Ticket on behalf of the domain user &ldquo;ASTRO\Cosmo&rdquo; to access the SQL Server service, because by design, the Web Server, not knowing the NT Hash (or a secrets) of the &ldquo;ASTRO\Cosmo&rdquo; account, CANNOT request a TGT (<a href=/posts/not_so_brief_overview_about_kerberos/#39>KRB_AS_REQ</a>) from the KDC on behalf of the user to then exchange it for a TGS Ticket specific to the SQL Server service.</p><blockquote><p>The traditional TGS Ticket that the Web Server receives from the &ldquo;ASTRO\Cosmo&rdquo; user is valid exclusively for the Web Server service (as it will contain the SPN HTTP/Web-Server and not a potential SPN SQL\SQLServer).</p></blockquote><p>Below is a diagram representing this situation:</p><img src=/demystify_kerberos_delegation/1.png class=center style=border-radius:8px><p>The &ldquo;Kerberos Delegation&rdquo; feature alters the traditional Kerberos authentication flow to allow the Web Server to authenticate to the Database service on behalf of the domain user.</p><p>There are 3 types of Kerberos Delegation:</p><ul><li>Unconstrained Delegation</li><li>Constrained Delegation (1, 2)</li><li>Resource-Based Constrained (RBCD) Delegation</li></ul><p>I want to highlight that the Kerberos Delegation feature allows solving the &ldquo;<a href=https://techcommunity.microsoft.com/blog/askds/understanding-kerberos-double-hop/395463>Double Hop Problem</a>&rdquo;.</p><blockquote><p>In a internet-facing web services scenario, the user will generally NOT login via the Kerberos protocol to the Web Application, consequently the Web Application will necessarily need to authenticate to a potential Database using only an dedicated application user; furthermore, depending on the permissions and how it has been configured, the Web Application may have access to the database with administrative or limited permissions; in specific scenarios this could lead to issues.</p></blockquote><h2 id=unconstrained-delegation><strong>Unconstrained Delegation</strong></h2><p>The oldest and most dangerous version of Kerberos Delegation is the &ldquo;Unconstrained Kerberos Delegation&rdquo;.</p><p>The &ldquo;Unconstrained Kerberos Delegation&rdquo;, in summary, alters the Kerberos protocol by making the Client send to the AP Front End a &ldquo;KRB_AP_REQ&rdquo; packet containing both the TGS Ticket (to access the same AP Front-End that receives this packet) and the TGT Ticket, in this way the &ldquo;Front-End&rdquo; AP will be able to use the domain user’s TGT Ticket to impersonate it in a further Kerberos authentication towards potentially ANY AP in the &ldquo;Back-End&rdquo;.</p><img src=/demystify_kerberos_delegation/2.png class=center style=border-radius:8px><p>The KDC, in order to use the &ldquo;Unconstrained Kerberos Delegation&rdquo;, requires 2 prerequisites:</p><p><strong>1. Configure the &ldquo;Unconstrained Kerberos Delegation&rdquo; on the &ldquo;Front-End&rdquo; AP.</strong></p><p><span id=1><img src=/demystify_kerberos_delegation/3.png class=center style=border-radius:8px></p><p>The &ldquo;Unconstrained Kerberos Delegation&rdquo; is configured via <a href=https://serveracademy.com/blog/active-directory-users-and-computers-aduc-installation-and-tutorial/>ADUC</a> by enabling the property &ldquo;Trust this computer for delegation to any service (Kerberos only)&rdquo; on the &ldquo;Computer&rdquo; object that acts as the &ldquo;Front-End&rdquo; AP; since this configuration is potentially dangerous, such action can only be performed by a Domain Admin account or an account with the &ldquo;<a href=https://harmj4.rssing.com/chan-30881824/article60.html>SeEnableDelegationPrivilege</a>&rdquo; permission.</p><blockquote><p>In reality, even an object of type &ldquo;user&rdquo; (domain account) can be configured with the Kerberos Unconstrained Delegation, in this way such domain account will be able to impersonate another domain account to authenticate against target APs (services), however, to do this it is necessary that such account has at least 1 SPN configured, in fact only in this specific case the &ldquo;Delegation&rdquo; tab will appear inside the property of the user object.</p></blockquote><p><span id=25>This configuration sets in the &ldquo;UserAccountControl&rdquo; property of the object in question the flag &ldquo;TRUSTED_FOR_DELEGATION&rdquo; to &ldquo;TRUE&rdquo; / &ldquo;1&rdquo;.</p><blockquote><p><span id=11>Every object of type &ldquo;User&rdquo; and type &ldquo;Computer&rdquo; has an attribute called &ldquo;<a href=https://activedirectorypro.com/useraccountcontrol-check-and-manage-attribute-value/>UserAccountControl</a>&rdquo;, this attribute is a value that represents the set of <a href="https://learn.microsoft.com/en-us/windows/win32/adschema/a-useraccountcontrol?redirectedfrom=MSDN">flags</a> (configurations) set on the object (the most common are DONT_REQUIRE_PREAUTH, NOT_DELEGATE, etc.), for example 514 indicates that the domain user is disabled.</p></blockquote><p>In our <a href=/posts/demystify_kerberos_delegation/#1>example</a> the Kerberos Delegation is configured on the Computer &ldquo;THEPUNISHER&rdquo; which will act as the &ldquo;Front-End&rdquo; AP, this modification is actually reflected on the related Computer Account since it is contained in the &ldquo;Computer&rdquo; object (therefore the Computer Account THEPUNISHER$ will have the flag &ldquo;TRUSTED_FOR_DELEGATION&rdquo; set to &ldquo;TRUE&rdquo; / &ldquo;1&rdquo;), this means that any service started by this computer with the Service Account THEPUNISHER$ (Computer Account) will have the Kerberos Unconstrained Delegation enabled (<a href=/posts/not_so_brief_overview_about_kerberos/#17>so, all services started with the Local Service account such as by default the CIFS service</a>).</p><p><span id=4><img src=/demystify_kerberos_delegation/4.png class=center style=border-radius:8px></p><blockquote><p>By default ALL Domain Controllers have the Kerberos Unconstrained Delegation enabled.</p></blockquote><p><strong>2. Configure the domain user that performs Kerberos authentication to the &ldquo;Front-End&rdquo; AP as &ldquo;relayable&rdquo;.</strong></p><p>It is necessary that the domain user that performs Kerberos authentication to the &ldquo;Front-End&rdquo; AP does NOT have the &ldquo;NOT_DELEGATED&rdquo; flag set to &ldquo;TRUE&rdquo; / &ldquo;1&rdquo; in the &ldquo;UserAccountControl&rdquo; property; if it is, then that user is NOT delegable, by default ALL domain users do NOT have this flag enabled and are therefore relayable.</p><img src=/demystify_kerberos_delegation/5.png class=center style=border-radius:8px><br><hr><br><p><strong>Below we see the flow of a Kerberos authentication with &ldquo;Unconstrained Delegation&rdquo; enabled:</strong></p><blockquote><p>To simplify the creation of the lab, even though this would hardly happen in reality, in the following screenshots the Front-End AP will be the CIFS service hosted on the THEPUNISHER computer (this service, having &ldquo;Local System&rdquo; as Service Account, <a href=/posts/not_so_brief_overview_about_kerberos/#17>in a Kerberos context the Service Account will be the Computer Account THEPUNISHER$</a>), in reality, usually, a Front-End AP could be a Web Application.</p></blockquote><img src=/demystify_kerberos_delegation/6.png class=center style=border-radius:8px><blockquote><p>The &ldquo;KRB_AP_REP&rdquo; packet (<a href=/posts/demystify_kerberos_delegation/#9>&ldquo;AP Front-End&rdquo; -> &ldquo;Client&rdquo;</a> & &ldquo;<a href=/posts/demystify_kerberos_delegation/#10>AP Back-End&rdquo; -> &ldquo;AP Front End</a>&rdquo;) required by the Mutual Authentication could be sent in different times based on the Windows machine version used inside the infrastructure, this is the reason why i have not putted them on the image.</p></blockquote><blockquote><p><span id=2>Integrity and authenticity verification operations that occur within traditional Kerberos authentication (sending & analyzing the &ldquo;Authenticator&rdquo; along with the related &ldquo;Session Key&rdquo; used to encrypt & decrypt parts of the packet) are also present with Unconstrained Delegation enabled, but in this case they will NOT be mentioned, because they have already been generally described <a href=/posts/not_so_brief_overview_about_kerberos/>previously</a> (for a complete analysis in the context of Unconstrained Delegation see <a href="https://www.youtube.com/watch?v=xDFRUYv1-eU&amp;t=326s">this guide</a>) and because it was preferred to instead emphasize the unique characteristics of Kerberos Unconstrained Delegation.</p></blockquote><blockquote><p><a href=/posts/not_so_brief_overview_about_kerberos/#40>As already mentioned previously</a>, below we will describe the traditional process where Kerberos with Unconstrained Delegation enabled is used, that is, from an Interactive Logon where a user enters their credentials within a WinLOGON GUI, and then subsequently uses Kerberos again in a Network Logon (roughly using cached credentials) to authenticate to a target service with Kerberos Unconstrained Delegation enabled; that said, in reality, the authentication process can also start in other types of authentications besides the traditional WinLOGON GUI (Interactive Logon).</p></blockquote><hr><br><p><strong>Introduction: Initially, the Client (after the domain user has entered their credentials for an Interactive Logon) makes a request for a TGT Ticket & TGS Session Key (KRB_AS_REQ) to the KDC and it responds (KRB_AS_REP) providing the requested data (if positive, in summary, the Client grants access to the domain user).</strong></p><h3 id=1-krb_tgs_req-the-client-provides-its-own-tgt-ticket-to-the-kdc-to-request-the-tgs-ticket><strong>1. KRB_TGS_REQ The Client provides its own TGT Ticket to the KDC to request the TGS Ticket.</strong></h3><p>Now that a domain user has already authenticated to a Client (using Kerberos) and already possesses the TGT with a TGS Session Key, if they need to perform a &ldquo;Network Logon&rdquo; the Kerberos protocol comes into play again, specifically the Client will use the TGT and the TGS Session Key to request another type of ticket called the TGS Ticket.</p><p>The Client presents to the KDC (no longer to the AS feature) a KRB_TGS_REQ which in summary contains:</p><img src=/demystify_kerberos_delegation/7.png class=center style=border-radius:8px><ul><li><p><strong>Ticket TGT</strong>: The previously received TGT ticket (to exchange it for a TGS Ticket)</p></li><li><p><strong>SPN</strong>: The SPN related to / pointing to the service the Client needs to connect to via SSO is sent in plain-text, in this case it refers to the AP Front-End, such as the SPN &ldquo;HTTP/Charlotte.medin.local&rdquo; or &ldquo;CIFS/THEPUNISHER&rdquo;, in the first one the authentication will be to the HTTP service on the Hostname &ldquo;Charlotte.medin.local&rdquo; while in the second one to the CIFS service on the Hostname THEPUNISHER.</p></li></ul><h3 id=2-krb_tgs_rep-the-kdc-sends-the-tgs-ticket-to-the-client-but-specifying-that-the-requested-service-has-the-kerberos-unconstrained-delegation-enabled><strong>2. KRB_TGS_REP: The KDC sends the TGS Ticket to the Client BUT specifying that the requested service has the Kerberos Unconstrained Delegation enabled.</strong></h3><p>The KDC receives the <a href=/posts/demystify_kerberos_delegation/#1-krb_tgs_req-the-client-provides-its-own-tgt-ticket-to-the-kdc-to-request-the-tgs-ticket>KRB_TGS_REQ</a> packet and after performing the <a href=/posts/demystify_kerberos_delegation/#2>usual checks</a> sees that the SPN contained within, in this example &ldquo;CIFS\THEPUNISHER&rdquo;, points to the CIFS service hosted on the computer THEPUNISHER which has as Service Account the &ldquo;Computer Account&rdquo; THEPUNISHER$ (<a href=/posts/not_so_brief_overview_about_kerberos/#17>in Kerberos context</a>), since this &ldquo;Computer Account&rdquo; has the <a href=/posts/demystify_kerberos_delegation/#4>TRUSTED_FOR_DELEGATION flag enabled</a>, it means the CIFS service on the computer THEPUNISHER has Kerberos Unconstrained Delegation, consequently the KDC responds to the Client with a &ldquo;KRB_TGS_REP&rdquo; containing, in summary:</p><img src=/demystify_kerberos_delegation/8.png class=center style=border-radius:8px><ul><li><strong>Ticket TGS</strong>: The TGS Ticket for the AP &ldquo;Front-End&rdquo; (CIFS Service hosted on &ldquo;THEPUNISHER&rdquo;) BUT with the flag &ldquo;OK-AS-DELEGATE&rdquo; set to TRUE</li></ul><blockquote><p>The &ldquo;FORWARDABLE&rdquo; flag is also set to TRUE
<span id=6></p></blockquote><h3 id=3-krb_tgs_req-the-client-requests-a><strong>3. KRB_TGS_REQ: The Client requests a &ldquo;Ticket TGT Forwarded&rdquo; from the KDC.</strong></h3><p>The Client receives the packet and after performing the <a href=/posts/demystify_kerberos_delegation/#2>usual checks</a> sees that the TGS Ticket received has the &ldquo;OK-AS-DELEGATE&rdquo; flag set to TRUE, this flag indicates to the Client that the service the domain user needs to access, namely the AP Front End, has Kerberos Unconstrained Delegation enabled, consequently the Client sends again a &ldquo;KRB_TGS_REQ&rdquo; containing, in summary:</p><img src=/demystify_kerberos_delegation/9.png class=center style=border-radius:8px><ul><li><p><strong>Previously received TGT Ticket</strong>: The previously received TGT Ticket (to exchange it this time for a &ldquo;Forwarded TGT Ticket&rdquo;)</p></li><li><p><strong>Other Data</strong>: Since the Client knows that the AP Front End has &ldquo;Kerberos Unconstrained Delegation&rdquo; configured, it choose to requests a so-called &ldquo;Forwarded TGT Ticket&rdquo;, for this purpose inside this Kerberos packet the Client specifies:</p><ul><li><p>The SPN related to the Kerberos service (KDC) of the Domain Controller which is &ldquo;krbtgt/&lt;domain>&rdquo; (analogous to what happens in a <a href=/posts/not_so_brief_overview_about_kerberos/#39>KRB_AS_REQ</a> but this time in a KRB_TGS_REQ)</p></li><li><p>The &ldquo;FORWARDED&rdquo; flag set to TRUE</p></li></ul></li></ul><span id=8><h3 id=4-krb_tgs_rep-the-kdc-sends-a><strong>4. KRB_TGS_REP: The KDC sends a &ldquo;Ticket TGT Forwarded&rdquo; to the Client</strong></h3><p>The KDC, after performing the <a href=/posts/demystify_kerberos_delegation/#2>usual checks</a>, since it previously sent a <a href=/posts/demystify_kerberos_delegation/#2-krb_tgs_rep-the-kdc-sends-the-tgs-ticket-to-the-client-but-specifying-that-the-requested-service-has-the-kerberos-unconstrained-delegation-enabled>KRB_TGS_REP</a> specifying that the service requested by the Client supports Kerberos Unconstrained Delegation, verifies if within the new <a href=/posts/demystify_kerberos_delegation/#6>KRB_TGS_REQ</a> received the &ldquo;FORWARDED&rdquo; flag is set to TRUE, if positive, the KDC responds to the Client with a &ldquo;KRB_TGS_REP&rdquo; containing, in summary:</p><img src=/demystify_kerberos_delegation/10.png class=center style=border-radius:8px><ul><li><strong>The &ldquo;Forwarded TGT Ticket&rdquo;</strong>: The KDC sends to the Client a so-called &ldquo;Forwarded TGT Ticket&rdquo;, that is a TGT Ticket with the &ldquo;FORWARDED&rdquo; flag set to True (which contains like always the PAC of the Client&rsquo;s domain user).</li></ul><blockquote><p>I want to highlight that the KDC sent a &ldquo;Forwarded TGT Ticket&rdquo; within the encrypted part of a KRB_TGS_REP, in a traditional Kerberos authentication the KDC would issue a TGT Ticket exclusively in a <a href=/posts/not_so_brief_overview_about_kerberos/#9>KRB_AS_REP</a>.</p></blockquote><span id=7><h3 id=5-krb_ap_req-the-client-attempts-to-access-the-front-end-ap-by-providing-its-own-tgs-ticket-but-also-sharing-the-so-called><strong>5. KRB_AP_REQ: The Client attempts to access the Front-End AP by providing its own TGS Ticket BUT also sharing the so-called &ldquo;Ticket TGT Forwarded&rdquo;.</strong></h3><p>The Client, after the <a href=/posts/demystify_kerberos_delegation/#2>usual checks</a>, in summary, sends a &ldquo;KRB_AP_REQ&rdquo; packet to the AP Front-End (in this case to the CIFS service hosted on the computer THEPUNISHER) containing:</p><img src=/demystify_kerberos_delegation/11.png class=center style=border-radius:8px><ul><li><p><strong>Ticket TGS</strong>: A TGS Ticket that points via SPN to the AP Front End (in this example CIFS\THEPUNISHER)</p></li><li><p><strong>Forwarded TGT Ticket</strong>: The &ldquo;Forwarded TGT Ticket&rdquo; that the Client received in the previous &ldquo;<a href=/posts/demystify_kerberos_delegation/#8>KRB_TGS_REP&rdquo;</a>.</p></li></ul><blockquote><p>I want to highlight that the &ldquo;Forwarded TGT Ticket&rdquo; sent is contained within the &ldquo;authenticator&rdquo; field of the &ldquo;TGS Ticket&rdquo;.</p></blockquote><hr><p><strong>So, what happens now?</strong></p><p>The AP Front End, now having received the <a href=/posts/demystify_kerberos_delegation/#7>KRB_AP_REQ</a> packet, in summary, after the <a href=/posts/demystify_kerberos_delegation/#2>usual checks</a>, performs the following actions:</p><ol><li>The AP Front End will allow (<a href=/posts/not_so_brief_overview_about_kerberos/#3>if the AUTHORIZATION phase goes correctly</a>) the Client access to the requested service (in this case the CIFS service hosted on the computer THEPUNISHER), subsequently, depending on the requested service and if mutual authentication is required by the Client, the AP Front End will send a KRB_AP_REP to the Client.</li></ol><blockquote><p><span id=9>In my home lab the KRB_AP_REP packet was sent in this scenario, <a href="https://www.youtube.com/watch?v=xDFRUYv1-eU&amp;t=326s">in this other case</a>, however, the KRB_AP_REP packet was delivered to the Client only at the end of the entire process.</p></blockquote><ol start=2><li>The AP Front End will now extract the &ldquo;Forwarded TGT Ticket&rdquo; contained within the TGS Ticket and cache it locally to potentially impersonate the Client in future interactions.</li></ol><hr><p><strong>If the AP Front End needs to authenticate to an AP Back End on behalf of the Client, the following actions will occur:</strong></p><h3 id=6-krb_tgs_req-the-front-end-ap-provides-the-clients><strong>6. KRB_TGS_REQ: The Front-End AP provides the Client’s &ldquo;Ticket TGT Forwarded&rdquo; to the KDC to request a TGS Ticket.</strong></h3><p>Occasionally, when the AP Front End will need to authenticate to the AP Back End on behalf of the Client, the AP Front End will send to the KDC a &ldquo;KRB_TGS_REQ&rdquo; packet built <a href=/posts/demystify_kerberos_delegation/#1-krb_tgs_req-the-client-provides-its-own-tgt-ticket-to-the-kdc-to-request-the-tgs-ticket>as already indicated previously</a>, with the only difference that the Client’s &ldquo;Ticket TGT Forwarded&rdquo; will be shared instead (it contains the domain user’s PAC), in this way the AP Front End will be able to obtain a valid TGS Ticket to authenticate to the AP in the Back-End on behalf of the Client.</p><h3 id=7-krb_tgs_rep-the-kdc-sends-the-tgs-ticket-to-the-front-end-ap><strong>7. KRB_TGS_REP: The KDC sends the TGS Ticket to the Front-End AP.</strong></h3><p>The KDC, in summary, after the <a href=/posts/demystify_kerberos_delegation/#2>usual checks</a>, will provide the AP Front End with a TGS Ticket specific for the AP in the Back End.</p><blockquote><p><a href=/posts/not_so_brief_overview_about_kerberos/#42>As already said</a>, the PAC of the TGS Ticket is a copy of the PAC contained in the provided TGT Ticket, consequently the TGS Ticket that the KDC will provide to the AP Front End will still belong to the Client.</p></blockquote><h3 id=8-krb_ap_req-the-ap-front-end-presents-the-tgs-ticket-to-the-ap-back-end-to-authenticate-on-behalf-of-the-client><strong>8. KRB_AP_REQ: The AP Front End presents the TGS Ticket to the AP Back End to authenticate on behalf of the Client.</strong></h3><p>The AP Front End will send a &ldquo;KRB_AP_REQ&rdquo; packet to the AP Back End, authenticating by essentially sharing the previously received TGS Ticket, since this TGS Ticket belongs to the Client (it contains the domain user’s PAC), the AP Front End will authenticate to the AP Back End on behalf of the Client.</p><p>Finally, if the AP Front End requests mutual authentication, the AP Back End will reply to the AP Front End with a &ldquo;KRB_AP_REP&rdquo;.</p><blockquote><p><span id=10>This is what happens in my home lab, <a href="https://www.youtube.com/watch?t=326&amp;v=xDFRUYv1-eU&amp;feature=youtu.be">in this other case</a> instead, the &ldquo;KRB_AP_REP&rdquo; packet is first sent from the AP Back End to the AP Front End and then <a href=/posts/demystify_kerberos_delegation/#9>as already told</a> another &ldquo;KRB_AP_REP&rdquo; from the AP Front End to the Client.</p></blockquote><h2 id=constrained-delegation><strong>Constrained Delegation</strong></h2><p>As we have seen, the &ldquo;Unconstrained Kerberos Delegation&rdquo; can be extremely dangerous since the AP Front End caches the Client’s TGT Ticket and can also impersonate the user towards ANY AP in the Back End, for this reason Microsoft developed a more restrictive (a.k.a &ldquo;Constrained&rdquo;) version of Kerberos Delegation called &ldquo;Constrained Delegation&rdquo;, specifically it supports 2 Kerberos extensions known as <a href=https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/3bff5864-8135-400e-bdd9-33b552051d94>Service For User (S4U)</a>:</p><ol><li><p>Service for User to Proxy (S4U2Proxy): Allows the AP Front End to obtain a TGS Ticket on behalf of the Client in order to use it in an authentication to the AP in the Back End.</p></li><li><p>Service for User to Self (S4U2Self): Allows the AP Front End to obtain a TGS Ticket valid for itself on behalf of any Client, such Ticket can be used by the AP Front End as evidence that the Client has authenticated to it.</p></li></ol><p>By using these Kerberos extensions it is possible to restrict (Constrained) the functionality of Kerberos Delegation by ensuring that the AP Front End can authenticate on behalf of the Client exclusively to a predefined set of APs in the Back End, furthermore, to achieve this, the Client’s TGT Ticket is NOT required and therefore there is no risk of it being cached.</p><p>Below there is a diagram showing how the Constrained Delegation works:</p><img src=/demystify_kerberos_delegation/12.png class=center style=border-radius:8px><p>It is possible to configure Constrained Delegation on the AP Front End in 2 different modes:</p><ul><li><p><strong>Trust this computer for delegation to specified service only (Kerberos only)</strong>: The AP Front End is able to impersonate the Client only if the Client logs into it via Kerberos (it uses the S4U2Proxy extension);this scenario is also called <strong>&ldquo;Kerberos Only&rdquo;</strong>.</p></li><li><p><strong>Trust this computer for delegation to specified service only (Use any authentication protocol)</strong>: The AP Front End is able to impersonate the Client if the Client logs into it with any type of protocol, such as NTLM (it uses the S4U2Self & S4U2Proxy extensions); this scenario is also called <strong>&ldquo;Protocol Transition&rdquo;</strong>.</p></li></ul><p>To analyze with Wireshark ALL the flows that occur during this Constrained Delegation I would have had to create from scratch a lab composed of a Front End Service that accepts a Kerberos authentication and develop within it a logic that triggers an additional Kerberos authentication towards the Back-End Server, since I did not find a quick method on how to do this, the screenshots you will see in this section come from this <a href="https://www.youtube.com/watch?v=gzqq2r6cZjc&amp;t=2779s">awesome guide</a>.</p><h2 id=constrained-delegation-kerberos-only><strong>Constrained Delegation (Kerberos only)</strong></h2><p>The KDC, in order to use the &ldquo;Constrained Delegation (Kerberos only)&rdquo;, requires 2 prerequisites:</p><p><strong>1. Configure the &ldquo;Constrained Delegation (Kerberos only)&rdquo; on the &ldquo;Front-End&rdquo; AP.</strong></p><span id=15><img src=/demystify_kerberos_delegation/13.png class=center style=border-radius:8px><p>The &ldquo;Constrained Delegation (Kerberos only)&rdquo; is configured via <a href=https://serveracademy.com/blog/active-directory-users-and-computers-aduc-installation-and-tutorial/>ADUC</a> by enabling the property &ldquo;Trust this computer for delegation to specified service only (Kerberos only)&rdquo; on the &ldquo;Computer&rdquo; object that acts as the &ldquo;Front-End&rdquo; AP; since this configuration is potentially dangerous, such action can only be performed by a Domain Admin account or an account with the &ldquo;<a href=https://harmj4.rssing.com/chan-30881824/article60.html>SeEnableDelegationPrivilege</a>&rdquo; permission.</p><blockquote><p>In reality, even an object of type &ldquo;user&rdquo; (domain account) can be configured with the Kerberos Constrained Delegation (Kerberos only), in this way such domain account will be able to impersonate another domain account to authenticate against target APs (services), however, to do this it is necessary that such account has at least 1 SPN configured, in fact only in this specific case the &ldquo;Delegation&rdquo; tab will appear inside the property of the user object; specifically, the &ldquo;Kerberos Only&rdquo; flow described later will remain unchanged with the only difference that when referring to the Service Account &ldquo;Computer Account,&rdquo; the Service Account &ldquo;User&rdquo; will be used instead.</p></blockquote><p>Furthermore, it is mandatory to fill the section indicated just below; with it, the domain administrator is able to restrict (a.k.a constrain) which Back-End APs the Front-End AP can authenticate on behalf of the Client.</p><p>This configuration sets in the <a href=/posts/demystify_kerberos_delegation/#11>UserAccountControl</a> property of the AP &ldquo;Front End&rdquo; object the flag &ldquo;msds-allowedtodelegateto&rdquo;, which contains in the form of SPNs all the &ldquo;Back End&rdquo; APs for which the &ldquo;Front End&rdquo; AP has permission to authenticate on behalf of the Client.</p><p>In our <a href=/posts/demystify_kerberos_delegation/#15>example</a>, the Kerberos Delegation is configured on the Computer &ldquo;WEB01&rdquo; which will act as the Front-End AP, this modification is actually reflected on the related Computer Account since it is contained in the &ldquo;Computer&rdquo; object, so the Computer Account &ldquo;WEB01$&rdquo; will have the &ldquo;msds-allowedtodelegateto&rdquo; property filled, this means that any service started by this computer with the Service Account WEB01$ (Computer Account) will have &ldquo;Kerberos Constrained Delegation (Kerberos Only)&rdquo; enabled (<a href=/posts/not_so_brief_overview_about_kerberos/#17>so, all services started with the Local Service account such as by default the CIFS service or HTTP like in this example</a>).</p><span id=25><img src=/demystify_kerberos_delegation/14.png class=center style=border-radius:8px><p>In conclusion, all services started with the WEB01$ user, such as in this case the HTTP service (AP Front End), will have &ldquo;Constrained Delegation (Kerberos only)&rdquo; enabled; so, in this scenario, they will be able to authenticate on behalf of the Client exclusively on the CIFS service of the SQL01 computer (AP Back-End).</p><p><strong>2. Configure the domain user that performs Kerberos authentication to the &ldquo;Front-End&rdquo; AP as &ldquo;relayable&rdquo;.</strong></p><p>It is necessary that the domain user that performs Kerberos authentication to the &ldquo;Front-End&rdquo; AP does NOT have the &ldquo;NOT_DELEGATED&rdquo; flag set to &ldquo;TRUE&rdquo; / &ldquo;1&rdquo; in the &ldquo;UserAccountControl&rdquo; property; if it is, then that user is NOT delegable, by default ALL domain users do NOT have this flag enabled and are therefore relayable.</p><img src=/demystify_kerberos_delegation/5.png class=center style=border-radius:8px><br><hr><br><p><strong>Below we see the flow of a Kerberos authentication with &ldquo;Constrained Delegation (Kerberos only)&rdquo; enabled:</strong></p><img src=/demystify_kerberos_delegation/15.png class=center style=border-radius:8px><blockquote><p>The &ldquo;KRB_AP_REP&rdquo; packet ("<a href=/posts/demystify_kerberos_delegation/#12>AP Front-End" -> &ldquo;Client&rdquo;</a>) & &ldquo;AP Back-End&rdquo; -> &ldquo;AP Front End&rdquo;) required by the Mutual Authentication could be sent in different times based on the Windows computer version used inside the infrastructure, with this flow i choose to put down the most common scenario.</p></blockquote><blockquote><p><span id=2>Integrity and authenticity verification operations that occur within traditional Kerberos authentication (sending & analyzing the &ldquo;Authenticator&rdquo; along with the related &ldquo;Session Key&rdquo; used to encrypt & decrypt parts of the packet) are also present with Unconstrained Delegation enabled, but in this case they will NOT be mentioned, because they have already been generally described <a href=/posts/not_so_brief_overview_about_kerberos/>previously</a> (for a complete analysis in the context of Unconstrained Delegation see <a href="https://www.youtube.com/watch?v=xDFRUYv1-eU&amp;t=326s">this guide</a>) and because it was preferred to instead emphasize the unique characteristics of Kerberos Unconstrained Delegation.</p></blockquote><blockquote><p><a href=/posts/not_so_brief_overview_about_kerberos/#40>As already mentioned previously</a>, below we will describe the traditional process where Kerberos with Unconstrained Delegation enabled is used, that is, from an Interactive Logon where a user enters their credentials within a WinLOGON GUI, and then subsequently uses Kerberos again in a Network Logon (roughly using cached credentials) to authenticate to a target service with Kerberos Unconstrained Delegation enabled; that said, in reality, the authentication process can also start in other types of authentications besides the traditional WinLOGON GUI (Interactive Logon).</p></blockquote><hr><br><p><strong>Introduction: Initially, the Client (after the domain user has entered their credentials for an Interactive Logon) makes a request for a TGT Ticket & TGS Session Key (KRB_AS_REQ) to the KDC and it responds (KRB_AS_REP) providing the requested data (if positive, in summary, the Client grants access to the domain user).</strong></p><h3 id=1-krb_tgs_req-the-client-provides-its-tgt-ticket-to-the-kdc-to-request-the-tgs-ticket><strong>1. KRB_TGS_REQ: The Client provides its TGT Ticket to the KDC to request the TGS Ticket.</strong></h3><p>Now that a domain user has already authenticated to a Client (using Kerberos) and already holds the TGT Ticket with a TGS Session Key, if there is a need to perform a &ldquo;Network Logon&rdquo; login, the Kerberos protocol comes into play again, specifically the Client will use the TGT Ticket and the TGS Session Key to request another type of ticket called the TGS Ticket.</p><p>The Client presents to the KDC (no longer to the AS functionality) a KRB_TGS_REQ which in summary contains:</p><ul><li><p>The Client shares its previously received TGT Ticket (to exchange it for a TGS Ticket)</p></li><li><p>SPN: The SPN related to / pointing to the service that the Client needs to connect to via SSO is sent in plain text, in this case it refers to the AP Front-End, such as the SPN &ldquo;HTTP/WEB01&rdquo;, that is, a request for authentication to the HTTP service present on the hostname &ldquo;WEB01&rdquo; is made.
<span id=23></p></li></ul><h3 id=2-krb_tgs_rep-the-kdc-sends-the-tgs-ticket-to-the-client><strong>2. KRB_TGS_REP: The KDC sends the TGS Ticket to the Client.</strong></h3><p>The KDC receives the KRB_TGS_REQ packet and, after performing the <a href=/posts/demystify_kerberos_delegation/#2>usual checks</a>, sends a &ldquo;KRB_TGS_REP&rdquo; packet containing in summary:</p><ul><li>The TGS Ticket for the &ldquo;Front End&rdquo; AP (HTTP Service hosted on &ldquo;WEB01&rdquo;)</li></ul><h3 id=3-krb_ap_req-the-client-attempts-to-access-the-front-end-ap-by-providing-its-tgs-ticket><strong>3. KRB_AP_REQ: The Client attempts to access the Front-End AP by providing its TGS Ticket</strong></h3><p>After the <a href=/posts/demystify_kerberos_delegation/#2>usual checks</a>, the Client, in summary, sends a &ldquo;KRB_AP_REQ&rdquo; packet to the Front-End AP (HTTP service) containing in summary:</p><ul><li>Ticket TGS: Its own TGS Ticket (<a href=/posts/demystify_kerberos_delegation/#2-krb_tgs_rep-the-kdc-sends-the-tgs-ticket-to-the-client>previously received</a>)</li></ul><h3 id=4-krb_ap_rep-optional-the-ap-front-end-http-will-allow-the-client-access-to-the-requested-service><strong>4. KRB_AP_REP (Optional): The AP Front End (HTTP) will allow the Client access to the requested service:</strong></h3><p>The AP Front End, now that it has received the KRB_AP_REQ packet, in summary, after the <a href=/posts/demystify_kerberos_delegation/#2>usual checks</a>, will allow (<a href=/posts/not_so_brief_overview_about_kerberos/#3>if the AUTHORIZATION phase goes correctly</a>) the Client access to the requested service (in this case the HTTP service hosted on the WEB01 computer), subsequently, depending on the requested service and if mutual authentication is required by the Client, the AP Front End will send a &ldquo;KRB_AP_REP&rdquo; to the Client.</p><blockquote><p><span id=12>In my home lab the KRB_AP_REP packet was sent in this way, <a href="https://youtu.be/gzqq2r6cZjc?t=1309">in this other case</a>, however, the KRB_AP_REP packet was delivered to the Client only at the end of the entire process.</p></blockquote><hr><p><strong>If the AP Front End needs to authenticate to a Back End AP on behalf of the Client, the following actions will take place:</strong></p><hr><h3 id=5-krb_tgs_req-s4u2proxy--s4uself-request><strong>5. KRB_TGS_REQ (S4U2Proxy) / S4USelf Request</strong></h3><p>Occasionally, when the AP Front End (so the HTTP service) needs to authenticate to the Back End AP (so the CIFS service) on behalf of the Client, the AP Front End will send to the KDC a &ldquo;KRB_TGS_REQ (S4U2Proxy)&rdquo; packet containing, in summary:</p><ul><li><p><strong>The AP Front End shares its own TGT Ticket</strong>:</p><p>Every computer joined in a domain, during its startup, will perform a Kerberos authentication using its corresponding Computer Account; consequently the WEB01 computer will also have stored in memory the TGT Ticket of the WEB01$ account.</p><p>In this scenario, the AP Front End will send the TGT Ticket of its Computer Account.</p><img src=/demystify_kerberos_delegation/16.png class=center style=border-radius:8px></li></ul><span id=24><ul><li><p><strong>SPN of the Back-End service:</strong></p><p>The SPN related to / pointing to the Back-End service that the Front-End service needs to connect to on behalf of the Client is sent, in this case, it refers to the Back-End AP identified by the SPN &ldquo;CIFS/SQL01&rdquo;, so the CIFS service hosted on the &ldquo;SQL01&rdquo; computer.</p><img src=/demystify_kerberos_delegation/17.png class=center style=border-radius:8px></li></ul><span id=20><ul><li><p><strong>Client&rsquo;s TGS Ticket:</strong></p><p>The TGS Ticket that the Client used to access the AP Front End (HTTP service on the WEB01 computer) will be sent.</p><p>This TGS Ticket is contained within the &ldquo;Additional Ticket&rdquo; field:</p><img src=/demystify_kerberos_delegation/18.png class=center style=border-radius:8px><p><span id=21>Additionally, it should be noted that the sent TGS Ticket will have the &ldquo;Forwardable&rdquo; flag set to &ldquo;1&rdquo;; by default, all TGS Tickets have this characteristic, that said, in this scenario this flag will be interpreted and therefore it is important to specify it.</p><img src=/demystify_kerberos_delegation/19.png class=center style=border-radius:8px></li></ul><span id=22><ul><li><p><strong>The flags &ldquo;Resource-Based Constrained-Delegation&rdquo; & &ldquo;Constrained-Delegation&rdquo; both set to &ldquo;1&rdquo; / &ldquo;TRUE&rdquo;:</strong></p><p>The AP Front End, within the KRB_TGS_REQ packet, will set the flags &ldquo;Resource-Based Constrained-Delegation&rdquo; & &ldquo;Constrained-Delegation&rdquo; both to &ldquo;1&rdquo; / &ldquo;TRUE&rdquo;; this is done because in case of a FallBack, so if the &ldquo;Constrained Delegation (Kerberos only)&rdquo; fails, the Delegation can proceed with &ldquo;Resource-Based Constrained Delegation (RBCD) flow&rdquo;.</p><p><img src=/demystify_kerberos_delegation/20.png class=center style=border-radius:8px><br><img src=/demystify_kerberos_delegation/21.png class=center style=border-radius:8px></p></li></ul><h3 id=6-krb_><strong>6. KRB_TGS_REP (S4U2Proxy) / S4USelf Response</strong></h3><p>The KDC, after performing authenticity checks and analyzing the KRB_TGS_REQ (S4U2Proxy) packet received from the AP Front, will perform further verifications <strong>sequentially</strong>:</p><ol><li>The KDC verifies if the <a href=/posts/demystify_kerberos_delegation/#20>&ldquo;TGS Ticket&rdquo; used by the Client to access the AP Front End (HTTP/WEB01)</a> is inside in the received <a href=/posts/demystify_kerberos_delegation/#5-krb_tgs_req-s4u2proxy--s4uself-request>KRB_TGS_REQ (S4U2Proxy)</a> packet, which would provide to the KDC the evidence that the Client has indeed authenticated to the AP Front End (HTTP Service on the WEB01 machine) (and therefore that the AP Front End can potentially impersonate the Client); it also checks that this TGS Ticket has the &ldquo;FORWARDABLE&rdquo; flag set to &ldquo;1&rdquo;) (<a href=/posts/demystify_kerberos_delegation/#21>positive result in this case</a>)</li></ol><blockquote><p>As detailed by <a href="https://www.youtube.com/watch?t=2487&amp;v=gzqq2r6cZjc&amp;feature=youtu.be">Microsoft&rsquo;s wiki</a>, if the TGS Ticket does NOT have the <a href=/posts/demystify_kerberos_delegation/#21>&ldquo;FORWARDABLE&rdquo; flag</a> set & <a href=/posts/demystify_kerberos_delegation/#22>if the RBDC flag was NOT configured in the KRB_TGS_REQ (S4U2Proxy)</a>, then the KDC would respond with an error (KRB_ERRBADOPTION); instead, if the RBDC flag is set (by default it is), the KDC will attempt to use RBCD Delegation.</p><p>In the typical scenario, like the used in our example, the TGS Ticket sent in the KRB_TGS_REQ (S4U2Proxy) will always have the FORWARDABLE flag TRUE, because it was received by a traditionally <a href=/posts/demystify_kerberos_delegation/#23>&ldquo;KRB_TGS_REP&rdquo;</a>, consequently Kerberos Constrained Delegation (Kerberos Only) practically NEVER fails and so the fallback case where &ldquo;Resource Based Constrained Delegation (RBCD&rdquo;) would be used is extremely rare.</p></blockquote><ol start=2><li>The KDC, inspecting the <a href=/posts/demystify_kerberos_delegation/#24>SPN contained in the KRB_TGS_REQ (S4U2Proxy) packet</a>, will understand that the AP Front End (ex HTTP/WEB01) intends to authenticate to a specific AP Back-End (ex CIFS/SQL01) on behalf of the Client; consequently, the KDC retrieves the Service Account of the AP Front End (WEB01$) and checks if the SPN of the requested AP Back End (in this case CIFS/SQL01) is present in its &ldquo;msds-allowedtodelegateto&rdquo; property (<a href=/posts/demystify_kerberos_delegation/#25>positive result in this case</a>)</li></ol><p>If both verifications are positive, as in our case, then the KDC sends a KRB_TGS_REP (S4U2Proxy) packet to the AP Front End containing, in summary:</p><ul><li><p><strong>A TGS Ticket of the Client to access the AP Back-End</strong>:</p><p>The KDC then sends within a &ldquo;KRB_TGS_REP (S4U2Proxy)&rdquo; a TGS Ticket belonging to the Client (containing the PAC of the domain user who authenticated to the AP Front End - inside the image, in the field dedicated to the user name i just wrote a placeholder to avoid a screenshot madness) valid for the AP Back-End (CIFS/SQL01)</p><img src=/demystify_kerberos_delegation/22.png class=center style=border-radius:8px><p>Furthermore, i want to highlight that the TGS Ticket sent will have the &ldquo;Forwardable&rdquo; flag set to &ldquo;1&rdquo;, by default this characteristic is present in ALL TGS Tickets; that said, in this scenario the flag will be interpreted and therefore it is important to clarify.</p><img src=/demystify_kerberos_delegation/23.png class=center style=border-radius:8px></li></ul><h3 id=7-krb_ap_req><strong>7. KRB_AP_REQ:</strong></h3><p>The AP Front End (HTTP service), after the <a href=/posts/demystify_kerberos_delegation/#2>usual checks</a>, in summary, sends a &ldquo;KRB_AP_REQ&rdquo; packet to the AP Back-End (CIFS service) containing, in summary:</p><ul><li><strong>The previously received TGS Ticket</strong>: The previously received TGS Ticket, that is, the one belonging to the Client (containing the PAC of the domain user who authenticated to the AP Front End) and valid for the AP Back-End (CIFS/SQL01).</li></ul><p>([if the AUTHORIZATION phase goes correctly](./not_so_brief_overview_about_kerberos#3</p><h3 id=8-krb_ap_rep-optional><strong>8. KRB_AP_REP (Optional)</strong></h3><p>The AP Back-End, now having received the KRB_AP_REQ packet from the AP Front-End, in summary, after the <a href=/posts/demystify_kerberos_delegation/#2>usual checks</a> (<a href=/posts/not_so_brief_overview_about_kerberos/#3>if the AUTHORIZATION phase goes correctly</a>, will allow access by the AP Front End to the requested service (in this case the CIFS service hosted on the SQL01 machine); subsequently, depending on the requested service and if mutual authentication is required by the AP Front End (ex HTTP service), the AP Back-End (ex CIFS service) will send a KRB_AP_REP to the AP Front End (ex HTTP service).</p><blockquote><p>This is what happens in my home lab; <a href="https://www.youtube.com/watch?t=1309&amp;v=gzqq2r6cZjc&amp;feature=youtu.be">in this case</a>, however, the &ldquo;KRB_AP_REP&rdquo; packet is sent first by the AP Back-End to the AP Front-End and then (<a href=/posts/demystify_kerberos_delegation/#12>as already told</a>) another &ldquo;KRB_AP_REP&rdquo; is sent from the AP Front End to the Client.</p></blockquote><p>In this way, the AP Front-End has successfully authenticated to the AP Back-End on behalf of the Client.</p><h2 id=constrained-delegation-use-any-authentication-protocol--protocol-transition><strong>Constrained Delegation (Use any authentication Protocol) / Protocol Transition</strong></h2><p>In a &ldquo;<a href=/posts/demystify_kerberos_delegation/#constrained-delegation-kerberos-only>Constrained Delegation (Kerberos Only)</a>&rdquo; the AP Front End (ex HTTP) can use the S4U2Proxy extension to obtain from the KDC the Client’s TGS Ticket (ex MARVEL\pparker) to access the AP Back End (ex CIFS); to do this, the AP Front End (ex HTTP) must share the TGS Ticket that the Client (ex MARVEL\pparker) used to authenticate to it, that said, if the AP Front End (ex HTTP) does NOT have such TGS Ticket because the Client authenticated using, for example, NTLM or Basic authentication, this method cannot be used, and for this reason the &ldquo;S4USelf&rdquo; extension was created.</p><p>In this scenario the AP Front End (ex HTTP) can invoke the S4U2Self extension, in other words, it requests from the KDC a TGS Ticket of a specific Client (ex MARVEL\pparker) valid exclusively for itself (ex HTTP), this can then be used by the AP Front End as &ldquo;evidence&rdquo; to subsequently invoke the S4U2Proxy extension; this scenario is called &ldquo;Constrained Delegation (Use any authentication protocol)&rdquo;.</p><p>The KDC, in order to use the &ldquo;Constrained Delegation (Kerberos only)&rdquo;, requires 2 prerequisites:</p><p><strong>1. Configure the &ldquo;Constrained Delegation (Use any authentication protocol)&rdquo; on the &ldquo;Front-End&rdquo; AP.</strong></p><span id=15><img src=/demystify_kerberos_delegation/24.png class=center style=border-radius:8px><p>The &ldquo;Constrained Delegation (Use any authentication protocol)&rdquo; is configured via <a href=https://serveracademy.com/blog/active-directory-users-and-computers-aduc-installation-and-tutorial/>ADUC</a> by enabling the property &ldquo;Trust this computer for delegation to specified service only (Use any authentication protocol)&rdquo; on the &ldquo;Computer&rdquo; object that acts as the &ldquo;Front-End&rdquo; AP; since this configuration is potentially dangerous, such action can only be performed by a Domain Admin account or an account with the &ldquo;<a href=https://harmj4.rssing.com/chan-30881824/article60.html>SeEnableDelegationPrivilege</a>&rdquo; permission.</p><blockquote><p>In reality, even an object of type &ldquo;user&rdquo; (domain account) can be configured with the &ldquo;Constrained Delegation (Use any authentication protocol)&rdquo;, in this way such domain account will be able to impersonate another domain account to authenticate against target APs (services), however, to do this it is necessary that such account has at least 1 SPN configured, in fact only in this specific case the &ldquo;Delegation&rdquo; tab will appear inside the property of the user object; specifically, the &ldquo;Kerberos Only&rdquo; flow described later will remain unchanged with the only difference that when referring to the Service Account &ldquo;Computer Account,&rdquo; the Service Account &ldquo;User&rdquo; will be used instead.</p></blockquote><p>Furthermore, it is mandatory to fill the section indicated just below; with it, the domain administrator is able to restrict (a.k.a constrain) which Back-End APs the Front-End AP can authenticate on behalf of the Client.</p><p>This configuration sets in the <a href=/posts/demystify_kerberos_delegation/#11>UserAccountControl</a> property of the AP &ldquo;Front End&rdquo; object:</p><ul><li><p>The &ldquo;TRUSTED_TO_AUTH_FOR_DELEGATION&rdquo; flag (it is different from <a href=/posts/demystify_kerberos_delegation/#25>TRUSTED_FOR_DELEGATION of Unconstrained Delegation</a>)</p></li><li><p>The &ldquo;msds-allowedtodelegateto&rdquo; flag, which contains in the form of SPNs all the AP &ldquo;Back End&rdquo; services to which the AP &ldquo;Front End&rdquo; is allowed to authenticate on behalf of the Client;</p></li></ul><p>In our <a href=/posts/demystify_kerberos_delegation/#15>example</a>, the Kerberos Delegation is configured on the Computer &ldquo;WEB01&rdquo; which will act as the Front-End AP, this modification is actually reflected on the related Computer Account since it is contained in the &ldquo;Computer&rdquo; object, so the Computer Account &ldquo;WEB01$&rdquo; will have the &ldquo;msds-allowedtodelegateto&rdquo; & &ldquo;TRUSTED_TO_AUTH_FOR_DELEGATION&rdquo; property filled, this means that any service started by this computer with the Service Account WEB01$ (Computer Account) will have &ldquo;Constrained Delegation (Use any authentication protocol)&rdquo; enabled (<a href=/posts/not_so_brief_overview_about_kerberos/#17>so, all services started with the Local Service account such as by default the CIFS service or HTTP like in this example</a>).</p><span id=30><img src=/demystify_kerberos_delegation/25.png class=center style=border-radius:8px><p>In conclusion, all services started with the WEB01$ user, such as in this case the HTTP service (AP Front End), will have &ldquo;Constrained Delegation (Use any authentication protocol)&rdquo; enabled; so, in this scenario, they will be able to authenticate on behalf of the Client exclusively on the CIFS service of the SQL01 computer (AP Back-End).</p><p><strong>2. Configure the domain user that performs Kerberos authentication to the &ldquo;Front-End&rdquo; AP as &ldquo;relayable&rdquo;.</strong></p><p>It is necessary that the domain user that performs Kerberos authentication to the &ldquo;Front-End&rdquo; AP does NOT have the &ldquo;NOT_DELEGATED&rdquo; flag set to &ldquo;TRUE&rdquo; / &ldquo;1&rdquo; in the &ldquo;UserAccountControl&rdquo; property; if it is, then that user is NOT delegable, by default ALL domain users do NOT have this flag enabled and are therefore relayable.</p><img src=/demystify_kerberos_delegation/5.png class=center style=border-radius:8px><br><hr><br><p><strong>Below we see the flow of a Kerberos authentication with Constrained Delegation (Use any authentication protocol) enabled:</strong></p><img src=/demystify_kerberos_delegation/26.png class=center style=border-radius:8px><blockquote><p>The &ldquo;KRB_AP_REP&rdquo; packet (<a href=/posts/demystify_kerberos_delegation/#9>&ldquo;AP Front-End&rdquo; -> &ldquo;Client&rdquo;</a> & &ldquo;<a href=/posts/demystify_kerberos_delegation/#10>AP Back-End&rdquo; -> &ldquo;AP Front End</a>&rdquo;) required by the Mutual Authentication could be sent in different times based on the Windows machine version used inside the infrastructure, this is the reason why i have not putted them on the image.</p></blockquote><blockquote><p><span id=2>Integrity and authenticity verification operations that occur within traditional Kerberos authentication (sending & analyzing the &ldquo;Authenticator&rdquo; along with the related &ldquo;Session Key&rdquo; used to encrypt & decrypt parts of the packet) are also present with Unconstrained Delegation enabled, but in this case they will NOT be mentioned, because they have already been generally described <a href=/posts/not_so_brief_overview_about_kerberos/>previously</a> (for a complete analysis in the context of Unconstrained Delegation see <a href="https://www.youtube.com/watch?v=xDFRUYv1-eU&amp;t=326s">this guide</a>) and because it was preferred to instead emphasize the unique characteristics of Kerberos Unconstrained Delegation.</p></blockquote><blockquote><p><a href=/posts/not_so_brief_overview_about_kerberos/#40>As already mentioned previously</a>, below we will describe the traditional process where Kerberos with Unconstrained Delegation enabled is used, that is, from an Interactive Logon where a user enters their credentials within a WinLOGON GUI, and then subsequently uses Kerberos again in a Network Logon (roughly using cached credentials) to authenticate to a target service with Kerberos Unconstrained Delegation enabled; that said, in reality, the authentication process can also start in other types of authentications besides the traditional WinLOGON GUI (Interactive Logon).</p></blockquote><hr><br><h3 id=1-client-authenticates-to-an-ap-front-end-not-using-kerberos><strong>1. Client authenticates to an AP Front End NOT using Kerberos.</strong></h3><p>A domain user authenticates to an AP Front End NOT using the Kerberos protocol (NTLM, Basic, etc).</p><p><strong>If the AP Front End needs to authenticate to an AP Back End on behalf of the Client, the following actions will take place:</strong></p><h3 id=2-krb_tgs_req-s4u2self--s4uself-request><strong>2. KRB_TGS_REQ (S4U2Self) / S4USelf Request.</strong></h3><p>Occasionally, when the AP Front End (ex HTTP service) needs to authenticate to the AP Back End (ex CIFS service) on behalf of the Client (ex CAPSULE.corp\vegeta), since the Client (ex CAPSULE.corp\vegeta) authenticated using, for example, the NTLM protocol, the AP Front End will NOT have the Client’s TGS Ticket and therefore will NOT be able to invoke S4U2Proxy as in the <a href=/posts/demystify_kerberos_delegation/#constrained-delegation-kerberos-only>Constrained Delegation (Kerberos Only)</a> scenario, consequently the AP Front End will resort to the &ldquo;S4U2Self&rdquo; extension, that is, it will send to the KDC a &ldquo;KRB_TGS_REQ&rdquo; packet containing, in summary:</p><p>Note: The S4U2Self extension in summary serves to obtain a TGS Ticket belonging to a specific Client (ex CAPSULE.corp\vegeta) valid for the service itself, namely for the AP Front End (ex HTTP).</p><h2 id=beahviour-change-about-kerberos-delegation-on-modern-windows-system>Beahviour Change about Kerberos Delegation on Modern Windows System</h2></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
6126 Words</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2025-09-16 14:50</p></div><hr><div class=sharing-buttons><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmarcozufferli.github.io%2fposts%2fdemystify_kerberos_delegation%2f" target=_blank rel=noopener aria-label title="Share on facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmarcozufferli.github.io%2fposts%2fdemystify_kerberos_delegation%2f" target=_blank rel=noopener aria-label title="Share on twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=Demystify%20Kerberos%20Delegation&amp;caption=Demystify%20Kerberos%20Delegation&amp;canonicalUrl=https%3a%2f%2fmarcozufferli.github.io%2fposts%2fdemystify_kerberos_delegation%2f" target=_blank rel=noopener aria-label title="Share on tumblr"><div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093.0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941.0 9.999.0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/></svg></div></div></a><a class=resp-sharing-button__link href="mailto:?subject=Demystify%20Kerberos%20Delegation&amp;body=https%3a%2f%2fmarcozufferli.github.io%2fposts%2fdemystify_kerberos_delegation%2f" target=_self rel=noopener aria-label title="Share via email"><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div></div></a><a class=resp-sharing-button__link href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmarcozufferli.github.io%2fposts%2fdemystify_kerberos_delegation%2f&amp;media=https%3a%2f%2fmarcozufferli.github.io%2fposts%2fdemystify_kerberos_delegation%2f;description=Demystify%20Kerberos%20Delegation" target=_blank rel=noopener aria-label title="Share on pinterest"><div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12.017.0C5.396.0.029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024.0 1.518.769 1.518 1.688.0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128.0 3.768-2.245 3.768-5.487.0-2.861-2.063-4.869-5.008-4.869-3.41.0-5.409 2.562-5.409 5.199.0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646.0-3.776 2.748-7.252 7.92-7.252 4.158.0 7.392 2.967 7.392 6.923.0 4.135-2.607 7.462-6.233 7.462-1.214.0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607.0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017.0z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmarcozufferli.github.io%2fposts%2fdemystify_kerberos_delegation%2f&amp;title=Demystify%20Kerberos%20Delegation&amp;summary=Demystify%20Kerberos%20Delegation&amp;source=https%3a%2f%2fmarcozufferli.github.io%2fposts%2fdemystify_kerberos_delegation%2f" target=_blank rel=noopener aria-label title="Share on linkedin"><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fmarcozufferli.github.io%2fposts%2fdemystify_kerberos_delegation%2f&amp;resubmit=true&amp;title=Demystify%20Kerberos%20Delegation" target=_blank rel=noopener aria-label title="Share on reddit"><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2fmarcozufferli.github.io%2fposts%2fdemystify_kerberos_delegation%2f;title=Demystify%20Kerberos%20Delegation" target=_blank rel=noopener aria-label title="Share on xing"><div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.188.0c-.517.0-.741.325-.927.66.0.0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211.0.375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016.0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894.0 21.686.0h-3.498zM3.648 4.74c-.211.0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016.0.021L1.86 16.051c-.099.188-.093.381.0.529.085.142.239.234.45.234h3.461c.518.0.766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></svg></div></div></a><a class=resp-sharing-button__link href="whatsapp://send?text=Demystify%20Kerberos%20Delegation%20https%3a%2f%2fmarcozufferli.github.io%2fposts%2fdemystify_kerberos_delegation%2f" target=_blank rel=noopener aria-label title="Share on whatsapp"><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893a11.821 11.821.0 00-3.48-8.413z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fmarcozufferli.github.io%2fposts%2fdemystify_kerberos_delegation%2f&amp;t=Demystify%20Kerberos%20Delegation" target=_blank rel=noopener aria-label title="Share on hacker news"><div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://telegram.me/share/url?text=Demystify%20Kerberos%20Delegation&amp;url=https%3a%2f%2fmarcozufferli.github.io%2fposts%2fdemystify_kerberos_delegation%2f" target=_blank rel=noopener aria-label title="Share on telegram"><div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></div></div></a></div><div class=pagination><div class=pagination__buttons><span class="button next"><a href=https://marcozufferli.github.io/posts/not_so_brief_overview_about_kerberos/><span class=button__text>Not So Brief Overview about Kerberos</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.ad54ad97364f77ede35def9096b162bb1f0b3973aa50b080f5e82fa147f6882e2a7200d7535adbf9b51bebf939f1c1ca9bbe6be87530092aca720eac4a226fda.js integrity="sha512-rVStlzZPd+3jXe+QlrFiux8LOXOqULCA9egvoUf2iC4qcgDXU1rb+bUb6/k58cHKm75r6HUwCSrKcg6sSiJv2g=="></script></body></html>